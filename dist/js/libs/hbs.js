define(["hbs/handlebars","hbs/underscore","hbs/i18nprecompile","hbs/json2"],function(e,n,r,t){var s,i,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=function(){throw new Error("Environment unsupported.")},u=[],c="w+",f="hbs",l="@hbs",h="/styles/",p="/demo-build/styles/",d="templates/helpers/",m="templates/i18n/",g="screen.build.css",b="onHbsRead";e.registerHelper("$",function(){}),"undefined"!=typeof window&&window.navigator&&window.document&&!window.navigator.userAgent.match(/Node.js/)?(i=function(){var e,n,r;if("undefined"!=typeof XMLHttpRequest)return arguments[0]===!0?new XDomainRequest:new XMLHttpRequest;for(n=0;3>n;n++){r=a[n];try{e=new ActiveXObject(r)}catch(t){}if(e){a=[r];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},getIEVersion=function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var n=navigator.userAgent,r=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=r.exec(n)&&(e=parseFloat(RegExp.$1))}return e},o=function(e,n){var r=!1;if(0!=e.indexOf("http"))r=!1;else{var t="https"===e.substr(0,5)?8:7,s="https"===window.location.href.substr(0,5)?8:7,a=e.substr(t).split("/").shift(),o=getIEVersion();r=a!=window.location.href.substr(s).split("/").shift()&&o>=7}if(r){var u=i(!0);u.open("GET",e),u.onload=function(){n(u.responseText,e)},u.onprogress=function(){},u.ontimeout=function(){},u.onerror=function(){},setTimeout(function(){u.send()},0)}else{var c=i();c.open("GET",e,!0),c.onreadystatechange=function(){4===c.readyState&&n(c.responseText,e)},c.send(null)}}):"undefined"!=typeof process&&process.versions&&process.versions.node?(s=require.nodeRequire("fs"),o=function(e,n){var r=s.readFileSync(e,"utf8")||"";r=r.replace(/^\uFEFF/,""),n(r,e)}):"undefined"!=typeof java&&"undefined"!=typeof java.io&&(o=function(e,n){for(var r,t=new java.io.FileInputStream(e),s=new java.io.InputStreamReader(t,"UTF-8"),i=new java.io.BufferedReader(s),a="";null!==(r=i.readLine());)a+=new String(r)+"\n";i.close(),n(a,e)});var v,y={},w=function(e,n){y[e]?n(y[e]):o(e,function(e,r){y[r]=e,n.call(this,e)})},E=[],T={},q=[];return{get:function(){return e},write:function(e,n,r){if(n+l in u){var t=u[n+l];r.asModule(e+"!"+n,t)}},version:"2.0.0",load:function(s,i,a,y){function x(e,r){return n(e).forEach(function(e){e&&e.type&&"partial"===e.type&&r.push(e.partialName.name),e&&e.program&&e.program.statements&&x(e.program.statements,r),e&&e.inverse&&e.inverse.statements&&x(e.inverse.statements,r)}),r}function S(e){var r=[];return e&&e.statements&&(r=x(e.statements,[])),n.unique(r)}function M(e){var n,r,s;if(e&&e.statements&&(n=e.statements[0],n&&"comment"===n.type))try{return r=n.comment.replace(new RegExp("^[\\s]+|[\\s]+$","g"),""),s=t.parse(r),r}catch(i){return t.stringify({description:r})}return"{}"}function N(e){if(!e)return[];var n,r=[e[0]],t=e[0];for(n=1;n<e.length;++n)e.hasOwnProperty(n)&&(t+="."+e[n],r.push(t));return r}function A(r,t,s,i){s=s?s+".":"";var a="";return n(r).forEach(function(r){var o,u,c;if(r&&r.type&&"mustache"===r.type){if(!r.params||!r.params.length){o=N(r.id.parts);for(u in o)o[u]&&(a=o[u]||a,t.push(s+o[u]));t.push(s+r.id.string)}var f=["this",".","..","./..","../..","../../.."];r.params&&"undefined"==typeof e.helpers[r.id.string]&&(n(r.params).forEach(function(u){(n(f).contains(u.original)||u instanceof e.AST.StringNode||u instanceof e.AST.NumberNode||u instanceof e.AST.BooleanNode||u instanceof e.AST.DataNode||u instanceof e.AST.SexprNode)&&(i.push(r.id.string),"undefined"!=typeof r.params&&n(r.params).forEach(function(e){"sexpr"===e.type&&e.isHelper===!0&&i.push(e.id.string)}),null!=r.hash&&"undefined"!=typeof r.hash&&"undefined"!=typeof r.hash.pairs&&n(r.hash.pairs).forEach(function(e){var n=(e[0],e[1]);"sexpr"===n.type&&n.isHelper===!0&&i.push(n.id.string)})),o=N(u.parts);for(var c in o)o[c]&&(a=o[c]||a,i.push(r.id.string),t.push(s+o[c]))}),null!=r.hash&&"undefined"!=typeof r.hash&&"undefined"!=typeof r.hash.pairs&&n(r.hash.pairs).forEach(function(n){var t=n[1];(t instanceof e.AST.StringNode||t instanceof e.AST.NumberNode||t instanceof e.AST.BooleanNode||t instanceof e.AST.IdNode)&&i.push(r.id.string)}))}r&&r.mustache&&A([r.mustache],t,s+a,i),r&&r.program&&r.program.statements&&(c=A([r.mustache],[],"",i)[0]||"",r.inverse&&r.inverse.statements&&A(r.inverse.statements,t,s+a+(c?s+a?"."+c:c:""),i),A(r.program.statements,t,s+a+(c?s+a?"."+c:c:""),i))}),t}function R(e){var r=[],t=[];e&&e.statements&&(r=A(e.statements,[],void 0,t));var s=["helperMissing","blockHelperMissing","each","if","unless","with","log","lookup"];return{vars:n(r).chain().unique().map(function(e){return""===e?".":e.length&&"."===e[e.length-1]?e.substr(0,e.length-1)+"[]":e}).value(),helpers:n(t).chain().unique().map(function(e){return n(s).contains(e)?void 0:e}).compact().value()}}function _(e){for(var n=e.split("/"),r=0;r<n.length;r++)".."===n[r]?(delete n[r-1],delete n[r]):"."===n[r]&&delete n[r];return n.join("/").replace(/\/\/+/g,"/")}function j(f){o(k,function(o,l){var m,y,w,x,N,A=v.isBuild&&v[b]?v[b]:function(e,n,r){return r},j=e.parse(A(s,l,o)),k=S(j),D=M(j),F=R(j),I=F.vars,X=F.helpers||[],U="",O="",C="",$=[],G=s.substr(0,s.lastIndexOf("/")+1);if(require.config.hbs=require.config.hbs||{},require.config.hbs._partials=require.config.hbs._partials||{},"{}"!==D)try{w=t.parse(D)}catch(K){console.log("couldn't parse meta for %s",l)}for(var V in k)if(k.hasOwnProperty(V)&&"string"==typeof k[V]){var l,z=k[V];l=_(z.match(/^(\.|\/)+/)?G+z:P+z),require.config.hbs._partials[l]=require.config.hbs._partials[l]||[],require.config.hbs._partials[l].references=require.config.hbs._partials[l].references||[],require.config.hbs._partials[l].references.push(z),require.config.hbs._loadedDeps=require.config.hbs._loadedDeps||{},$[V]="hbs!"+l}if(m=$.join("', '"),X=X.concat(w&&w.helpers?w.helpers:[]),y=L?"":function(){var e,n=[],r=v.hbs&&v.hbs.helperPathCallback?v.hbs.helperPathCallback:function(e){return(v.hbs&&v.hbs.helperDirectory?v.hbs.helperDirectory:d)+e};for(e=0;e<X.length;e++)n[e]="'"+r(X[e],l)+"'";return n}().join(","),y&&(y=","+y),w)try{w.styles&&(E=n.union(E,w.styles),require.isBrowser&&!v.isBuild?(x=document.head||document.getElementsByTagName("head")[0],n(w.styles).forEach(function(e){T[e]||(N=document.createElement("link"),N.href=v.baseUrl+h+e+".css",N.media="all",N.rel="stylesheet",N.type="text/css",x.appendChild(N),T[e]=N)})):v.isBuild&&!function(){var e=require.nodeRequire("fs"),r=n(w.styles).map(function(e){return T[e]?"":(T[e]=!0,"@import url("+e+".css);\n")}).join("\n");e.open(__dirname+p+g,c,"0666",function(n,t){e.writeSync(t,r,null,encoding="utf8"),e.close(t)}),c="a"}())}catch(K){console.log("error injecting styles")}v.isBuild||v.serverRender||(U="<!-- START - "+s+" -->",O="<!-- END - "+s+" -->",C="t.meta = "+D+";\nt.helpers = "+t.stringify(X)+";\nt.deps = "+t.stringify($)+";\nt.vars = "+t.stringify(I)+";\n");var J=B?!1:n.extend(f,v.localeMapping),Q=v.hbs||{},W=n.extend(Q.compileOptions||{},{originalKeyFallback:Q.originalKeyFallback}),Y=r(o,J,W),Z="'hbs!"+s+"',";m&&(m=", '"+m+"'");var en=[];require.config.hbs._partials[s]&&(en=require.config.hbs._partials[s].references),o="/* START_TEMPLATE */\ndefine("+Z+"['hbs','hbs/handlebars'"+m+y+"], function( hbs, Handlebars ){ \nvar t = Handlebars.template("+Y+");\nHandlebars.registerPartial('"+s+"', t);\n";for(var V=0;V<en.length;V++)o+="Handlebars.registerPartial('"+en[V]+"', t);\n";o+=C+"return t;\n});\n/* END_TEMPLATE */\n",v.isBuild&&(u[H]=o),v.isBuild||(o+="\r\n//# sourceURL="+l),v.isBuild?(a.fromText(s,o),i([s],function(e){a(e)})):require($,function(){a.fromText(o),i([s],function(e){a(e)})}),v.removeCombined&&l&&q.push(l)})}v=v||y;var H=s+l;v.hbs=v.hbs||{};var B=!(1==v.hbs.i18n),L=0==v.hbs.helpers,P="";v.hbs.partialsUrl&&(P=v.hbs.partialsUrl,P.match(/\/$/)||(P+="/")),v.hbs.fetchText&&(o=v.hbs.fetchText);var k,D=v.hbs&&v.hbs.templateExtension===!1;if(k=i.toUrl(D?s:s+"."+(v.hbs&&v.hbs.templateExtension?v.hbs.templateExtension:f)),B)j(!1);else{var F=(v.hbs&&v.hbs.i18nDirectory?v.hbs.i18nDirectory:m)+(v.locale||"en_us")+".json";try{w(i.toUrl(F),function(e){j(t.parse(e))})}catch(I){if(v.hbs)throw I;console.warn("hbs: Error reading "+F+", disabling i18n. Ignore this if you're using jam, otherwise check your i18n configuration.\n"),v.hbs={i18n:!1,helpers:!0},j(!1)}}},onLayerEnd:function(){v.removeCombined&&s&&q.forEach(function(e){s.existsSync(e)&&s.unlinkSync(e)})}}});