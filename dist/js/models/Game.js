define(["jquery","player"],function(e,r){function t(s,i){this.round=1,this.numPlayers=s,this.currentPlayer=0,this.gameMode=i,this.winner=null,this.players=[],this.history=[],this.saveHistory=function(){var s=new t(this.numPlayers,this.gameMode);s.round=this.round,s.currentPlayer=this.currentPlayer,s.winner=this.winner,e.each(this.players,function(e,t){var i=new r(t.name);i.retrieveFromJSON(t),s.players.push(i)}),this.history.push(s),this.history.length>=10&&this.history.splice(0,1)},this.restoreBackup=function(e){var r=this.history[e];this.numPlayers=r.numPlayers,this.gameMode=r.gameMode,this.round=r.round,this.currentPlayer=r.currentPlayer,this.winner=r.winner,this.players=r.players,console.log(r.players),console.log(this.players),this.history.splice(e,this.history.length-e)},this.addPoints=function(e,r){if("failures"==e)this.players[this.currentPlayer].addPointToSector(e);else for(var t=0;r>t;t++)if(this.players[this.currentPlayer].isClosedSector(e))for(var s=0;s<this.numPlayers;s++){var i=this.players[s];if("clasic"==this.gameMode){if(!i.isClosedSector(e)){this.players[this.currentPlayer].addPoints(e);break}}else"cutThroat"==this.gameMode&&(i.isClosedSector(e)||i.getName()==this.players[this.currentPlayer].getName()||this.players[s].addPoints(e))}else this.players[this.currentPlayer].addPointToSector(e)},this.getWinner=function(){if(null==this.winner){for(var e=0,r=0;r<this.numPlayers;r++){var t=this.players[r].getPoints().points;"clasic"==this.gameMode?t>e&&(e=t):"cutThroat"==this.gameMode&&(e>t||0==e)&&(e=t)}for(r=0;r<this.numPlayers;r++){var s=this.players[r];s.getPoints().points==e&&s.hasAllSectorsClosed()&&(this.winner=s)}}return this.winner},this.nextPlayer=function(){this.currentPlayer=(this.currentPlayer+1)%this.numPlayers,0==this.currentPlayer&&this.round++},this.retrieveFromJSON=function(s){this.numPlayers=s.numPlayers,this.currentPlayer=s.currentPlayer,this.round=s.round,this.gameMode=s.gameMode,null!=s.winner&&(this.winner=new r(s.winner.name),this.winner.retrieveFromJSON(s.winner));var i=[];e.each(s.players,function(e,t){var s=new r(t.name);s.retrieveFromJSON(t),i.push(s)}),this.players=i;var n=[];e.each(s.history,function(e,r){var s=new t(r.numPlayers,r.gameMode);s.retrieveFromJSON(r),n.push(s)}),this.history=n},this.getCurrentPlayer=function(){return this.players[this.currentPlayer]}}return t});