require(["jquery","game","player","localStorage","i18n!nls/lang","hbs!templates/body","bootstrap"],function(t,e,a,n,o,r){function l(e){var a=t(e);a.hasClass("noVisible")?a.removeClass("noVisible"):a.addClass("noVisible")}function s(){var e="",a=["f","s","t"];t.each(a,function(a,n){var r=t("#"+n+"Attempt").find(":selected").text();r.indexOf("document.write")>-1&&(r=r.split(";")[1]);var l=t("#"+n+"AttemptType").find(":selected").text();e+="<strong>"+o.attemptNum+" "+(a+1)+"</strong><br/><strong>"+o.sector+": </strong>"+r+"<br/><strong>"+o.type+": </strong>"+l+"<br/><br/>"}),t(".modal .modal-body").html(e)}function i(){var e=["f","s","t"];t.each(e,function(e,a){t("#"+a+"Attempt").val("failures"),t("#"+a+"AttemptType").val("1"),u(a)})}function d(){g.saveHistory()}function c(){var t=n.getLocalGameData(b);g=new e(t.numPlayers),g.retrieveFromJSON(t)}function u(e){var a=t("#"+e+"Attempt").find(":selected").val(),n=t("#"+e+"AttemptType");n.empty(),n.append(t("<option></option>").attr("value",1).text(o.simple)),"failures"!=a&&n.append(t("<option></option>").attr("value",2).text(o["double"])),"failures"!=a&&"bull"!=a&&n.append(t("<option></option>").attr("value",3).text(o.triple))}function p(e){for(var a="",n=1;e>=n;n++)a+='<div id="formGroupNamePlayer'+n+'" class="form-group"><label class="control-label" for="namePla'+n+'">'+o.name_player+" "+n+'</label><input type="text" class="form-control" id="namePla'+n+'" placeholder="'+o.player+" "+n+'"></div>';t(".data .players").html(a)}function m(){for(var o=t("#numJug").find(":selected").text(),r=t("#gameMode").find(":selected").val(),l=!1,s=[],i=1;o>=i;i++){var d=t("#namePla"+i).val(),c=t("#formGroupNamePlayer"+i);""==d?(c.addClass("has-error"),l=!0):(c.hasClass("has-error")&&c.removeClass("has-error"),s.push(new a(d)))}l||(g=new e(o,r),g.players=s,n.saveLocalGameData(b,g),h())}function f(){var e=["f","s","t"];t.each(e,function(e,a){var n=t("#"+a+"Attempt").val(),o=parseInt(t("#"+a+"AttemptType").val());g.addPoints(n,o)}),g.nextPlayer()}function h(){t(".data").addClass("noVisible"),null!=g.getWinner()&&(t("#winner").removeClass("noVisible"),t("#winner a").text(o.congratulations+" "+g.getWinner().getName()+"! "+o.you_win));var e="";t.each(g.players,function(t,a){e+="<tr>",e+="<td>"+a.getName()+"</td>",e+="<td>"+a.getPoints().sector20+"</td>",e+="<td>"+a.getPoints().sector19+"</td>",e+="<td>"+a.getPoints().sector18+"</td>",e+="<td>"+a.getPoints().sector17+"</td>",e+="<td>"+a.getPoints().sector16+"</td>",e+="<td>"+a.getPoints().sector15+"</td>",e+="<td>"+a.getPoints().bull+"</td>",e+="<td>"+a.getPoints().points+"</td>",e+="<td>"+a.getPoints().failures+"</td>",e+="</tr>"}),t(".game table tbody").html(e),t(".currentPlayer a").text(g.getCurrentPlayer().getName()+o.playerTurn),t(".game").removeClass("noVisible");for(var a="",n=g.history.length;n>0;n--){var r=g.history[n-1];a+='<div class="row"><div class="col-md-12">',a+="<h4>"+o.information+"</h4><hr/><p><b>"+o.round+" :</b> "+r.round+"<br/><b>"+o.player+":</b> "+r.players[r.currentPlayer].name+"</p>",a+=v(r.players),a+="</div></div>",a+='<div class="row"><div class="col-md-12" style="text-align: right"><button type="button" class="btn btn-default btnRestore" data-attribute="'+(n-1)+'">'+o.restore+"</button></div></div>",a+="<br/>"}""==a&&(a+=o.no_history),t(".backups").html(a),t("#showHistory").removeClass("noVisible")}function v(e){var a='<table class="table table-condensed table-striped table-bordered"><thead><tr><th>'+o.player+"</th><th>20</th><th>19</th><th>18</th><th>17</th><th>16</th><th>15</th><th>"+o.bull+"</th><th>"+o.points+"</th><th>"+o.failures+"</th></tr></thead>";return t.each(e,function(t,e){a+="<tr>",a+="<td>"+e.getName()+"</td>",a+="<td>"+e.getPoints().sector20+"</td>",a+="<td>"+e.getPoints().sector19+"</td>",a+="<td>"+e.getPoints().sector18+"</td>",a+="<td>"+e.getPoints().sector17+"</td>",a+="<td>"+e.getPoints().sector16+"</td>",a+="<td>"+e.getPoints().sector15+"</td>",a+="<td>"+e.getPoints().bull+"</td>",a+="<td>"+e.getPoints().points+"</td>",a+="<td>"+e.getPoints().failures+"</td>",a+="</tr>"}),a+="<tbody></tbody></table>"}var g,b="GameData",y="locale";t(document).ready(function(){t("body").append(r({lang:o})),t("#numJug").change(function(){p(t("#numJug").find(":selected").text())}),t("#btnData").click(function(){m()}),t("#btnNext").click(function(){s()}),t("#btnAccept").click(function(){d(),f(),i(),h(),n.saveLocalGameData(b,g)}),t(document).delegate(".btnRestore","click",function(e){var a=parseInt(t(e.target).data().attribute);g.restoreBackup(a),n.saveLocalGameData(b,g),location.reload()}),t("#langMenu li a").click(function(e){e.preventDefault();var a=t(this).data("locale");n.saveLocalGameData(y,a),location.reload()}),t("#newGame").click(function(t){t.preventDefault(),n.removeLocalGameData(b),location.reload()}),t(".changeScreen").click(function(t){t.preventDefault(),l("#showHistory"),l("#showGame"),l(".game"),l(".history")});var e=["f","s","t"];t.each(e,function(e,a){t("#"+a+"Attempt").change(function(){u(a)}),u(a)}),void 0!=n.getLocalGameData(b)&&(c(),h()),p(1)})});